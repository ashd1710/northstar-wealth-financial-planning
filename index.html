<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NorthStar Wealth - AI-Powered Financial Planning & Investment Guide Framework</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .built-with-bolt {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 50px;
            padding: 8px 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            font-weight: bold;
            color: #333;
            text-decoration: none;
            z-index: 1000;
        }

        .questionnaire-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 14%;
        }

        .question-section {
            margin-bottom: 40px;
        }

        .question-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .question-subtitle {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .option.selected {
            border-color: #667eea;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .option-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .option-description {
            color: #666;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }

        .results-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .risk-profile-summary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .allocation-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .allocation-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .allocation-percentage {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .product-breakdown {
            margin-top: 40px;
        }

        .asset-class-section {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .asset-class-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .asset-class-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .asset-class-allocation {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .product-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .product-name {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .product-allocation {
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
        }

        .product-details {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .product-type {
            display: inline-block;
            background: #e8f5e8;
            color: #2d5f2d;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            margin-top: 8px;
        }

        .chart-container {
            height: 400px;
            margin: 30px 0;
        }

        .sip-strategy {
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.1), rgba(139, 195, 74, 0.1));
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid #4CAF50;
        }

        .sip-header {
            font-size: 18px;
            font-weight: bold;
            color: #2d5f2d;
            margin-bottom: 15px;
        }

        .sip-amount {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .premium-banner {
            background: linear-gradient(45deg, #ff9800, #ff5722);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .premium-banner h3 {
            margin-bottom: 10px;
        }

        .unlock-btn {
            background: white;
            color: #ff5722;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }

        .monthly-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .monthly-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .monthly-amount {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }

        .monthly-product {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .input-row {
                grid-template-columns: 1fr;
            }
            
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .monthly-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Built with Bolt.new Badge -->
    <a href="https://bolt.new/" class="built-with-bolt" target="_blank">
        ⚡ Built with Bolt.new
    </a>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">NorthStar Wealth</div>
            <p style="color: #666; margin-top: 10px;">AI-Powered Financial Planning & Investment Guide Framework</p>
        </div>

        <!-- Questionnaire Container -->
        <div class="questionnaire-container" id="questionnaire">
            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <!-- Question 1: Basic Information -->
            <div class="question-section" id="question1">
                <div class="question-title">Let's start with your basic information</div>
                <div class="question-subtitle">This helps us understand your life stage and financial capacity</div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label" for="age">Age</label>
                        <input type="number" id="age" class="input-field" placeholder="e.g., 32" min="18" max="100">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="income">Annual Income (₹)</label>
                        <input type="number" id="income" class="input-field" placeholder="e.g., 1200000" min="0">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label" for="expenses">Monthly Expenses (₹)</label>
                        <input type="number" id="expenses" class="input-field" placeholder="e.g., 50000" min="0">
                    </div>
                    <div class="input-group">
                        <label class="input-label" for="dependents">Number of Dependents</label>
                        <input type="number" id="dependents" class="input-field" placeholder="e.g., 2" min="0" max="10">
                    </div>
                </div>
            </div>

            <!-- Question 2: Investment Experience -->
            <div class="question-section hidden" id="question2">
                <div class="question-title">What is your investment experience?</div>
                <div class="question-subtitle">This helps us gauge your comfort level with different investment products</div>
                
                <div class="options-container">
                    <div class="option" data-value="beginner" onclick="selectOption(this, 'experience')">
                        <div class="option-label">Beginner (0-2 years)</div>
                        <div class="option-description">New to investing, prefer simple and safe options like mutual funds</div>
                    </div>
                    <div class="option" data-value="intermediate" onclick="selectOption(this, 'experience')">
                        <div class="option-label">Intermediate (2-5 years)</div>
                        <div class="option-description">Some experience with mutual funds, ETFs, and basic stocks</div>
                    </div>
                    <div class="option" data-value="experienced" onclick="selectOption(this, 'experience')">
                        <div class="option-label">Experienced (5+ years)</div>
                        <div class="option-description">Comfortable with direct stocks, bonds, and sector investments</div>
                    </div>
                    <div class="option" data-value="expert" onclick="selectOption(this, 'experience')">
                        <div class="option-label">Expert (10+ years)</div>
                        <div class="option-description">Advanced investor comfortable with alternatives and derivatives</div>
                    </div>
                </div>
            </div>

            <!-- Question 3: Risk Tolerance -->
            <div class="question-section hidden" id="question3">
                <div class="question-title">How would you react to a 20% portfolio decline?</div>
                <div class="question-subtitle">This scenario helps us understand your emotional response to market volatility</div>
                
                <div class="options-container">
                    <div class="option" data-value="conservative" onclick="selectOption(this, 'riskTolerance')">
                        <div class="option-label">Sell everything immediately</div>
                        <div class="option-description">I cannot afford any losses and need my money to be safe</div>
                    </div>
                    <div class="option" data-value="moderate" onclick="selectOption(this, 'riskTolerance')">
                        <div class="option-label">Wait and monitor closely</div>
                        <div class="option-description">I'd be concerned but wait for some recovery before acting</div>
                    </div>
                    <div class="option" data-value="aggressive" onclick="selectOption(this, 'riskTolerance')">
                        <div class="option-label">Buy more at lower prices</div>
                        <div class="option-description">I see this as an opportunity to invest more at discounted prices</div>
                    </div>
                    <div class="option" data-value="very_aggressive" onclick="selectOption(this, 'riskTolerance')">
                        <div class="option-label">Use this as an opportunity to buy aggressively</div>
                        <div class="option-description">I'd actively look for undervalued opportunities and increase my investment pace</div>
                    </div>
                </div>
            </div>

            <!-- Question 4: Investment Horizon -->
            <div class="question-section hidden" id="question4">
                <div class="question-title">What is your primary investment time horizon?</div>
                <div class="question-subtitle">When do you need to access most of your invested money?</div>
                
                <div class="options-container">
                    <div class="option" data-value="short" onclick="selectOption(this, 'timeHorizon')">
                        <div class="option-label">Less than 3 years</div>
                        <div class="option-description">Need money soon for major purchases or expenses</div>
                    </div>
                    <div class="option" data-value="medium" onclick="selectOption(this, 'timeHorizon')">
                        <div class="option-label">3-10 years</div>
                        <div class="option-description">Saving for goals like home purchase or children's education</div>
                    </div>
                    <div class="option" data-value="long" onclick="selectOption(this, 'timeHorizon')">
                        <div class="option-label">10-20 years</div>
                        <div class="option-description">Building wealth for later life goals and retirement</div>
                    </div>
                    <div class="option" data-value="very_long" onclick="selectOption(this, 'timeHorizon')">
                        <div class="option-label">20+ years</div>
                        <div class="option-description">Long-term wealth building and retirement planning</div>
                    </div>
                </div>
            </div>

            <!-- Question 5: Financial Goals -->
            <div class="question-section hidden" id="question5">
                <div class="question-title">What is your primary financial goal?</div>
                <div class="question-subtitle">This helps us prioritize your investment strategy</div>
                
                <div class="options-container">
                    <div class="option" data-value="preservation" onclick="selectOption(this, 'goal')">
                        <div class="option-label">Capital Preservation</div>
                        <div class="option-description">Protect my money from inflation with minimal risk</div>
                    </div>
                    <div class="option" data-value="income" onclick="selectOption(this, 'goal')">
                        <div class="option-label">Regular Income</div>
                        <div class="option-description">Generate steady income from my investments</div>
                    </div>
                    <div class="option" data-value="balanced" onclick="selectOption(this, 'goal')">
                        <div class="option-label">Balanced Growth</div>
                        <div class="option-description">Moderate growth with reasonable safety</div>
                    </div>
                    <div class="option" data-value="growth" onclick="selectOption(this, 'goal')">
                        <div class="option-label">Capital Growth</div>
                        <div class="option-description">Maximize long-term wealth creation</div>
                    </div>
                </div>
            </div>

            <!-- Question 6: Emergency Fund -->
            <div class="question-section hidden" id="question6">
                <div class="question-title">Do you have an emergency fund?</div>
                <div class="question-subtitle">6-12 months of expenses saved in liquid instruments</div>
                
                <div class="options-container">
                    <div class="option" data-value="none" onclick="selectOption(this, 'emergencyFund')">
                        <div class="option-label">No emergency fund</div>
                        <div class="option-description">I don't have any emergency savings yet</div>
                    </div>
                    <div class="option" data-value="partial" onclick="selectOption(this, 'emergencyFund')">
                        <div class="option-label">1-3 months expenses</div>
                        <div class="option-description">I have some emergency savings but not enough</div>
                    </div>
                    <div class="option" data-value="adequate" onclick="selectOption(this, 'emergencyFund')">
                        <div class="option-label">3-6 months expenses</div>
                        <div class="option-description">I have a reasonable emergency fund</div>
                    </div>
                    <div class="option" data-value="full" onclick="selectOption(this, 'emergencyFund')">
                        <div class="option-label">6+ months expenses</div>
                        <div class="option-description">I have a complete emergency fund in place</div>
                    </div>
                </div>
            </div>

            <!-- Question 7: Income Stability -->
            <div class="question-section hidden" id="question7">
                <div class="question-title">How stable is your income?</div>
                <div class="question-subtitle">This affects your ability to take investment risks</div>
                
                <div class="options-container">
                    <div class="option" data-value="unstable" onclick="selectOption(this, 'incomeStability')">
                        <div class="option-label">Highly variable</div>
                        <div class="option-description">Freelancer, consultant, or commission-based income</div>
                    </div>
                    <div class="option" data-value="moderate" onclick="selectOption(this, 'incomeStability')">
                        <div class="option-label">Somewhat stable</div>
                        <div class="option-description">Job security exists but some uncertainty about future</div>
                    </div>
                    <div class="option" data-value="stable" onclick="selectOption(this, 'incomeStability')">
                        <div class="option-label">Very stable</div>
                        <div class="option-description">Secure job with predictable salary increases</div>
                    </div>
                    <div class="option" data-value="guaranteed" onclick="selectOption(this, 'incomeStability')">
                        <div class="option-label">Guaranteed income</div>
                        <div class="option-description">Government job, pension, or multiple income streams</div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Next</button>
            </div>
        </div>

        <!-- Results Container -->
        <div class="results-container" id="results">
            <div class="risk-profile-summary" id="riskProfileSummary">
                <!-- Dynamic content will be inserted here -->
            </div>

            <div class="allocation-overview" id="allocationOverview">
                <!-- Dynamic allocation cards will be inserted here -->
            </div>

            <div class="chart-container">
                <canvas id="allocationChart"></canvas>
            </div>

            <!-- Disclaimer -->
            <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 10px; margin: 20px 0; font-size: 14px;">
                <strong>⚠️ Important Disclaimer:</strong> This is a sample model portfolio for educational purposes only. The recommendations are based on general risk profiling and should not be considered as personalized investment advice. Please consult with a qualified investment advisor or financial planner before making any investment decisions. Past performance does not guarantee future results.
            </div>

            <!-- Portfolio Customization -->
            <div style="background: #e3f2fd; padding: 25px; border-radius: 15px; margin: 20px 0;">
                <h4 style="color: #1565c0; margin-bottom: 20px;">🎯 Customize Your Portfolio</h4>
                <p style="color: #666; margin-bottom: 20px;">Adjust allocations based on your preferences:</p>
                
                <!-- Asset Level Controls -->
                <div style="margin-bottom: 25px;">
                    <h5 style="color: #333; margin-bottom: 15px;">Asset Class Allocation:</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Equity: <span id="equityValue">65</span>%</label>
                            <input type="range" id="equitySlider" min="20" max="90" value="65" 
                                   onchange="updateAllocation('equity', this.value)" 
                                   style="width: 100%; accent-color: #667eea;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Fixed Income: <span id="fixedIncomeValue">25</span>%</label>
                            <input type="range" id="fixedIncomeSlider" min="5" max="70" value="25" 
                                   onchange="updateAllocation('fixedIncome', this.value)" 
                                   style="width: 100%; accent-color: #764ba2;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Alternatives: <span id="alternativesValue">7</span>%</label>
                            <input type="range" id="alternativesSlider" min="0" max="25" value="7" 
                                   onchange="updateAllocation('alternatives', this.value)" 
                                   style="width: 100%; accent-color: #f093fb;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Cash: <span id="cashValue">3</span>%</label>
                            <input type="range" id="cashSlider" min="0" max="20" value="3" 
                                   onchange="updateAllocation('cash', this.value)" 
                                   style="width: 100%; accent-color: #e0e0e0;">
                        </div>
                    </div>
                </div>

                <!-- Sub-Asset Level Controls -->
                <div id="subAssetControls" style="margin-top: 25px;">
                    <h5 style="color: #333; margin-bottom: 15px;">Equity Sub-Allocation:</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Large Cap: <span id="largeCapValue">40</span>%</label>
                            <input type="range" id="largeCapSlider" min="20" max="70" value="40" 
                                   onchange="updateSubAllocation('largeCap', this.value)" 
                                   style="width: 100%; accent-color: #667eea;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Mid Cap: <span id="midCapValue">25</span>%</label>
                            <input type="range" id="midCapSlider" min="10" max="40" value="25" 
                                   onchange="updateSubAllocation('midCap', this.value)" 
                                   style="width: 100%; accent-color: #764ba2;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Small Cap: <span id="smallCapValue">15</span>%</label>
                            <input type="range" id="smallCapSlider" min="0" max="30" value="15" 
                                   onchange="updateSubAllocation('smallCap', this.value)" 
                                   style="width: 100%; accent-color: #f093fb;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">International: <span id="internationalValue">20</span>%</label>
                            <input type="range" id="internationalSlider" min="0" max="30" value="20" 
                                   onchange="updateSubAllocation('international', this.value)" 
                                   style="width: 100%; accent-color: #ff9800;">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="resetToRecommended()" style="margin-top: 20px;">
                    Reset to AI Recommended
                </button>
            </div>

            <!-- Product Breakdown Section -->
            <div class="product-breakdown" id="productBreakdown">
                <!-- Dynamic product recommendations will be inserted here -->
            </div>

            <!-- SIP Strategy Section -->
            <div class="sip-strategy" id="sipStrategy">
                <!-- Dynamic SIP recommendations will be inserted here -->
            </div>

            <!-- Premium Banner -->
            <div class="premium-banner">
                <h3>🚀 Unlock Premium Features</h3>
                <p>Get specific fund recommendations, detailed fund analysis, tax optimization strategies, and priority support for just ₹19.99/month</p>
                <button class="unlock-btn" onclick="showPremiumFeatures()">Upgrade to Premium</button>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-primary" onclick="restartAssessment()">Retake Assessment</button>
                <button class="btn btn-primary" onclick="proceedToDashboard()" style="margin-left: 20px;">Continue to Dashboard</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentQuestion = 1;
        const totalQuestions = 7;
        let assessmentData = {};
        let allocationChart = null;
        let currentAllocations = {}; // Store current allocations for customization

        // Asset allocation frameworks with ranges
        const allocationFrameworks = {
            conservative: { equity: [20, 35], fixedIncome: [50, 65], alternatives: [8, 12], cash: [5, 10] },
            moderate: { equity: [45, 65], fixedIncome: [25, 40], alternatives: [8, 15], cash: [2, 8] },
            aggressive: { equity: [65, 80], fixedIncome: [15, 25], alternatives: [5, 12], cash: [1, 5] },
            veryAggressive: { equity: [75, 90], fixedIncome: [5, 15], alternatives: [3, 8], cash: [1, 3] }
        };

        // Category-based product database (SEBI compliant)
        const productDatabase = {
            equity: {
                beginner: [
                    { name: "Large Cap Mutual Funds", allocation: 0.45, type: "Large Cap", details: "Invest in top 100 companies by market cap. Recommended: 2-3 funds across different AMCs", funds: "2-3 funds" },
                    { name: "Equity Hybrid Funds", allocation: 0.3, type: "Hybrid", details: "Balanced allocation between equity (65-80%) and debt (20-35%)", funds: "1-2 funds" },
                    { name: "Index Funds/ETFs", allocation: 0.25, type: "Index", details: "Low-cost passive funds tracking Nifty 50 or Sensex", funds: "1-2 funds" }
                ],
                intermediate: [
                    { name: "Large Cap Mutual Funds", allocation: 0.3, type: "Large Cap", details: "Diversified large cap exposure across sectors", funds: "2-3 funds" },
                    { name: "Multi Cap Mutual Funds", allocation: 0.25, type: "Multi Cap", details: "Flexible allocation across large, mid, and small cap stocks", funds: "2-3 funds" },
                    { name: "Mid Cap Mutual Funds", allocation: 0.2, type: "Mid Cap", details: "Growth-oriented mid-cap companies (101-250 rank)", funds: "1-2 funds" },
                    { name: "International Equity Funds", allocation: 0.15, type: "International", details: "Global diversification through US/developed market exposure", funds: "1-2 funds" },
                    { name: "ELSS Tax Saver Funds", allocation: 0.1, type: "ELSS", details: "Equity funds with 3-year lock-in and 80C tax benefits", funds: "1 fund" }
                ],
                experienced: [
                    { name: "Direct Equity Stocks", allocation: 0.35, type: "Direct Equity", details: "Blue chip stocks: Banking, IT, FMCG, Energy sectors", funds: "15-20 stocks" },
                    { name: "Large Cap Mutual Funds", allocation: 0.2, type: "Large Cap", details: "Core holding in established large cap funds", funds: "2 funds" },
                    { name: "Small Cap Mutual Funds", allocation: 0.15, type: "Small Cap", details: "High growth potential in companies ranked 251+", funds: "1-2 funds" },
                    { name: "Sector/Thematic Funds", allocation: 0.15, type: "Sector", details: "Technology, Healthcare, Banking sector exposure", funds: "2-3 funds" },
                    { name: "Index Funds", allocation: 0.15, type: "Index", details: "Cost-efficient market exposure through index funds", funds: "1-2 funds" }
                ],
                expert: [
                    { name: "Direct Equity Portfolio", allocation: 0.45, type: "Direct Equity", details: "Concentrated portfolio of 10-15 high-conviction stocks", funds: "10-15 stocks" },
                    { name: "Small Cap Mutual Funds", allocation: 0.2, type: "Small Cap", details: "High alpha small cap strategies", funds: "2-3 funds" },
                    { name: "Sector/Thematic Funds", allocation: 0.15, type: "Sector", details: "Tactical allocation to emerging themes and sectors", funds: "3-4 funds" },
                    { name: "International Equity", allocation: 0.1, type: "International", details: "Global and emerging market exposure", funds: "2-3 funds" },
                    { name: "Alternative Equity Strategies", allocation: 0.1, type: "Alternative", details: "Contra funds, value funds, or equity arbitrage", funds: "1-2 funds" }
                ]
            },
            fixedIncome: {
                all: [
                    { name: "Public Provident Fund (PPF)", allocation: 0.3, type: "Tax-Free", details: "15-year lock-in, EEE tax benefits, currently ~7.1% returns", funds: "1 account" },
                    { name: "Employee Provident Fund (EPF)", allocation: 0.25, type: "Retirement", details: "Employer contribution scheme, currently ~8.5% returns", funds: "Auto-deducted" },
                    { name: "Corporate Bond Funds", allocation: 0.15, type: "Corporate Debt", details: "High-grade corporate bonds from AAA-rated companies", funds: "1-2 funds" },
                    { name: "Government Securities/Gilt Funds", allocation: 0.15, type: "Government", details: "Government of India bonds with sovereign guarantee", funds: "1 fund" },
                    { name: "Liquid/Ultra Short Funds", allocation: 0.1, type: "Liquid", details: "Emergency fund parking with better returns than savings", funds: "1 fund" },
                    { name: "Bank Fixed Deposits", allocation: 0.05, type: "Traditional", details: "Safe, guaranteed returns currently 6-7%", funds: "1-2 banks" }
                ]
            },
            alternatives: {
                conservative: [
                    { name: "Gold ETFs/Gold Funds", allocation: 0.7, type: "Gold", details: "Digital gold investment without storage hassles", funds: "1-2 funds" },
                    { name: "Additional Fixed Deposits", allocation: 0.3, type: "Fixed Deposit", details: "Extra safety buffer in bank FDs", funds: "1 bank" }
                ],
                moderate: [
                    { name: "Gold ETFs/Funds", allocation: 0.4, type: "Gold", details: "Portfolio diversifier and inflation hedge", funds: "1-2 funds" },
                    { name: "REITs (Real Estate)", allocation: 0.35, type: "REIT", details: "Commercial real estate exposure with regular dividends", funds: "1-2 REITs" },
                    { name: "Government Bond ETFs", allocation: 0.25, type: "Bond ETF", details: "PSU and government-backed bond exposure", funds: "1 ETF" }
                ],
                aggressive: [
                    { name: "Gold ETFs", allocation: 0.3, type: "Gold", details: "Portfolio hedge against market volatility", funds: "1 fund" },
                    { name: "REITs", allocation: 0.4, type: "REIT", details: "Real estate income and capital appreciation", funds: "2-3 REITs" },
                    { name: "Commodity Funds", allocation: 0.3, type: "Commodities", details: "Broad commodity exposure including energy and metals", funds: "1-2 funds" }
                ]
            }
        };

        // Option selection handler
        function selectOption(element, category) {
            try {
                const parent = element.parentElement;
                const options = parent.querySelectorAll('.option');
                
                options.forEach(opt => opt.classList.remove('selected'));
                element.classList.add('selected');
                assessmentData[category] = element.getAttribute('data-value');
            } catch (error) {
                console.error('Error in selectOption:', error);
            }
        }

        // Navigation functions
        function nextQuestion() {
            try {
                if (currentQuestion === 1) {
                    if (!validateBasicInfo()) return;
                } else {
                    if (!validateOptionSelection()) return;
                }

                if (currentQuestion < totalQuestions) {
                    hideCurrentQuestion();
                    currentQuestion++;
                    showCurrentQuestion();
                    updateProgress();
                } else {
                    showResults();
                }
            } catch (error) {
                console.error('Error in nextQuestion:', error);
            }
        }

        function previousQuestion() {
            try {
                if (currentQuestion > 1) {
                    hideCurrentQuestion();
                    currentQuestion--;
                    showCurrentQuestion();
                    updateProgress();
                }
            } catch (error) {
                console.error('Error in previousQuestion:', error);
            }
        }

        // Validation functions
        function validateBasicInfo() {
            try {
                const age = document.getElementById('age').value;
                const income = document.getElementById('income').value;
                const expenses = document.getElementById('expenses').value;
                const dependents = document.getElementById('dependents').value;

                if (!age || !income || !expenses || dependents === '') {
                    alert('Please fill in all required fields');
                    return false;
                }

                assessmentData.age = parseInt(age);
                assessmentData.income = parseInt(income);
                assessmentData.expenses = parseInt(expenses);
                assessmentData.dependents = parseInt(dependents);
                return true;
            } catch (error) {
                console.error('Error in validateBasicInfo:', error);
                return false;
            }
        }

        function validateOptionSelection() {
            try {
                const currentSection = document.getElementById(`question${currentQuestion}`);
                const selected = currentSection.querySelector('.option.selected');
                
                if (!selected) {
                    alert('Please select an option to continue');
                    return false;
                }
                return true;
            } catch (error) {
                console.error('Error in validateOptionSelection:', error);
                return false;
            }
        }

        // UI update functions
        function hideCurrentQuestion() {
            const section = document.getElementById(`question${currentQuestion}`);
            if (section) section.classList.add('hidden');
        }

        function showCurrentQuestion() {
            const section = document.getElementById(`question${currentQuestion}`);
            if (section) section.classList.remove('hidden');
            updateNavigationButtons();
        }

        function updateProgress() {
            const progress = (currentQuestion / totalQuestions) * 100;
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn) {
                prevBtn.style.display = currentQuestion === 1 ? 'none' : 'block';
            }
            
            if (nextBtn) {
                nextBtn.textContent = currentQuestion === totalQuestions ? 'View Results' : 'Next';
            }
        }

        // Enhanced risk calculation
        function calculateRiskProfile() {
            try {
                let score = 0;
                const factors = [];

                // Age factor (5-25 points)
                if (assessmentData.age < 30) {
                    score += 25;
                    factors.push("Young age allows for higher risk tolerance");
                } else if (assessmentData.age < 40) {
                    score += 20;
                    factors.push("Still in wealth accumulation phase");
                } else if (assessmentData.age < 50) {
                    score += 15;
                    factors.push("Approaching peak earning years");
                } else if (assessmentData.age < 60) {
                    score += 10;
                    factors.push("Pre-retirement planning phase");
                } else {
                    score += 5;
                    factors.push("Conservative approach for preservation");
                }

                // Experience (5-20 points)
                const expScores = { beginner: 5, intermediate: 10, experienced: 15, expert: 20 };
                score += expScores[assessmentData.experience] || 5;
                factors.push(`${assessmentData.experience} investor experience level`);

                // Risk tolerance (5-30 points)
                const riskScores = { conservative: 5, moderate: 15, aggressive: 25, very_aggressive: 30 };
                score += riskScores[assessmentData.riskTolerance] || 5;

                // Time horizon (5-30 points)
                const timeScores = { short: 5, medium: 15, long: 25, very_long: 30 };
                score += timeScores[assessmentData.timeHorizon] || 5;

                // Goals (5-20 points)
                const goalScores = { preservation: 5, income: 10, balanced: 15, growth: 20 };
                score += goalScores[assessmentData.goal] || 10;

                // Emergency fund (0-15 points)
                const emergencyScores = { none: 0, partial: 5, adequate: 10, full: 15 };
                score += emergencyScores[assessmentData.emergencyFund] || 0;
                if (assessmentData.emergencyFund === 'none' || assessmentData.emergencyFund === 'partial') {
                    factors.push("Emergency fund needs to be built first");
                }

                // Income stability (0-15 points)
                const stabilityScores = { unstable: 0, moderate: 5, stable: 10, guaranteed: 15 };
                score += stabilityScores[assessmentData.incomeStability] || 5;

                // Savings rate (0-10 points)
                const monthlyIncome = assessmentData.income / 12;
                const savingsRate = (monthlyIncome - assessmentData.expenses) / monthlyIncome;
                
                if (savingsRate > 0.3) {
                    score += 10;
                    factors.push("High savings rate supports higher risk capacity");
                } else if (savingsRate > 0.2) {
                    score += 7;
                    factors.push("Good savings rate allows moderate risk");
                } else if (savingsRate > 0.1) {
                    score += 3;
                    factors.push("Moderate savings rate limits risk capacity");
                } else {
                    score += 0;
                    factors.push("Low savings rate requires conservative approach");
                }

                // Determine profile
                let profile, description, framework;
                if (score <= 50) {
                    profile = "Conservative";
                    description = "Focus on capital preservation with steady, inflation-beating returns";
                    framework = "conservative";
                } else if (score <= 80) {
                    profile = "Moderate";
                    description = "Balanced approach between growth and stability with moderate volatility";
                    framework = "moderate";
                } else if (score <= 110) {
                    profile = "Aggressive";
                    description = "Growth-focused portfolio with higher volatility tolerance for better returns";
                    framework = "aggressive";
                } else {
                    profile = "Very Aggressive";
                    description = "Maximum growth potential with high risk tolerance and long-term focus";
                    framework = "veryAggressive";
                }

                return {
                    score,
                    profile,
                    description,
                    framework,
                    factors,
                    savingsRate
                };
            } catch (error) {
                console.error('Error in calculateRiskProfile:', error);
                return null;
            }
        }

        // Calculate specific allocations
        function calculateAllocations(riskProfile) {
            try {
                const framework = allocationFrameworks[riskProfile.framework];
                let allocations = {};

                // Age-based equity adjustment (Rule of 120 minus age)
                const maxEquity = Math.min(120 - assessmentData.age, framework.equity[1]);
                const minEquity = Math.max(framework.equity[0], maxEquity - 15);

                // Emergency fund adjustment
                let equityAdjustment = 0;
                if (assessmentData.emergencyFund === 'none') {
                    equityAdjustment -= 10;
                } else if (assessmentData.emergencyFund === 'partial') {
                    equityAdjustment -= 5;
                }

                // Income stability adjustment
                if (assessmentData.incomeStability === 'unstable') {
                    equityAdjustment -= 8;
                } else if (assessmentData.incomeStability === 'guaranteed') {
                    equityAdjustment += 5;
                }

                // Calculate final allocations
                allocations.equity = Math.max(15, Math.min(90, 
                    Math.floor((minEquity + maxEquity) / 2) + equityAdjustment));
                
                allocations.fixedIncome = Math.min(70, 
                    framework.fixedIncome[0] + Math.max(0, -equityAdjustment));
                
                allocations.alternatives = framework.alternatives[0] + 
                    Math.floor((framework.alternatives[1] - framework.alternatives[0]) / 2);
                
                // Ensure total is 100%
                const total = allocations.equity + allocations.fixedIncome + allocations.alternatives;
                allocations.cash = 100 - total;

                // Adjust if needed
                if (allocations.cash < 0) {
                    allocations.fixedIncome += allocations.cash;
                    allocations.cash = 0;
                }

                return allocations;
            } catch (error) {
                console.error('Error in calculateAllocations:', error);
                return { equity: 50, fixedIncome: 35, alternatives: 10, cash: 5 };
            }
        }

        // Get product recommendations
        function getProductRecommendations(allocations) {
            try {
                const experience = assessmentData.experience;
                const recommendations = {
                    equity: [],
                    fixedIncome: [],
                    alternatives: []
                };

                // Equity products based on experience
                if (productDatabase.equity[experience]) {
                    recommendations.equity = productDatabase.equity[experience].map(product => ({
                        ...product,
                        allocation: Math.round(product.allocation * allocations.equity)
                    }));
                }

                // Fixed income products (same for all experience levels)
                recommendations.fixedIncome = productDatabase.fixedIncome.all.map(product => ({
                    ...product,
                    allocation: Math.round(product.allocation * allocations.fixedIncome)
                }));

                // Alternative products based on risk profile
                const altLevel = allocations.equity > 70 ? 'aggressive' : 
                               allocations.equity > 50 ? 'moderate' : 'conservative';
                
                if (productDatabase.alternatives[altLevel]) {
                    recommendations.alternatives = productDatabase.alternatives[altLevel].map(product => ({
                        ...product,
                        allocation: Math.round(product.allocation * allocations.alternatives)
                    }));
                }

                return recommendations;
            } catch (error) {
                console.error('Error in getProductRecommendations:', error);
                return { equity: [], fixedIncome: [], alternatives: [] };
            }
        }

        // Calculate SIP strategy
        function calculateSIPStrategy(allocations) {
            try {
                const monthlyIncome = assessmentData.income / 12;
                const monthlySurplus = monthlyIncome - assessmentData.expenses;
                const investableAmount = Math.max(0, monthlySurplus * 0.8); // 80% of surplus

                const sipBreakdown = {
                    total: Math.round(investableAmount),
                    equity: Math.round(investableAmount * allocations.equity / 100),
                    fixedIncome: Math.round(investableAmount * allocations.fixedIncome / 100),
                    alternatives: Math.round(investableAmount * allocations.alternatives / 100)
                };

                return sipBreakdown;
            } catch (error) {
                console.error('Error in calculateSIPStrategy:', error);
                return { total: 0, equity: 0, fixedIncome: 0, alternatives: 0 };
            }
        }

        // Results display
        function showResults() {
            try {
                const riskProfile = calculateRiskProfile();
                if (!riskProfile) return;

                const allocations = calculateAllocations(riskProfile);
                currentAllocations = { ...allocations }; // Store for customization
                const products = getProductRecommendations(allocations);
                const sipStrategy = calculateSIPStrategy(allocations);
                
                // Hide questionnaire, show results
                document.getElementById('questionnaire').style.display = 'none';
                document.getElementById('results').style.display = 'block';

                // Update risk profile summary
                const summary = document.getElementById('riskProfileSummary');
                if (summary) {
                    summary.innerHTML = `
                        <h2>${riskProfile.profile} Investor Profile</h2>
                        <p>${riskProfile.description}</p>
                        <p style="margin-top: 15px; font-size: 14px; opacity: 0.9;">
                            Risk Score: ${riskProfile.score}/140 | Savings Rate: ${(riskProfile.savingsRate * 100).toFixed(1)}%
                        </p>
                    `;
                }

                // Update allocation overview
                const overview = document.getElementById('allocationOverview');
                if (overview) {
                    overview.innerHTML = `
                        <div class="allocation-card">
                            <div class="allocation-percentage">${allocations.equity}%</div>
                            <div>Equity Investments</div>
                            <small>Growth-oriented stocks and equity funds</small>
                        </div>
                        <div class="allocation-card">
                            <div class="allocation-percentage">${allocations.fixedIncome}%</div>
                            <div>Fixed Income</div>
                            <small>Bonds, FDs, and debt instruments</small>
                        </div>
                        <div class="allocation-card">
                            <div class="allocation-percentage">${allocations.alternatives}%</div>
                            <div>Alternatives</div>
                            <small>Gold, REITs, and other diversifiers</small>
                        </div>
                        <div class="allocation-card">
                            <div class="allocation-percentage">${allocations.cash}%</div>
                            <div>Cash & Liquid</div>
                            <small>Emergency fund and liquid investments</small>
                        </div>
                    `;
                }

                // Create chart
                createChart(allocations);

                // Display product breakdown
                displayProductBreakdown(products, allocations);

                // Display SIP strategy
                displaySIPStrategy(sipStrategy, products);

            } catch (error) {
                console.error('Error in showResults:', error);
            }
        }

        // Portfolio customization functions
        function updateAllocation(assetType, value) {
            try {
                value = parseInt(value);
                currentAllocations[assetType] = value;
                
                // Update display
                document.getElementById(assetType + 'Value').textContent = value;
                
                // Ensure total doesn't exceed 100%
                const total = Object.values(currentAllocations).reduce((sum, val) => sum + val, 0);
                if (total > 100) {
                    // Proportionally adjust other allocations
                    const excess = total - 100;
                    const otherAssets = Object.keys(currentAllocations).filter(key => key !== assetType);
                    otherAssets.forEach(asset => {
                        const reduction = Math.floor(excess / otherAssets.length);
                        currentAllocations[asset] = Math.max(0, currentAllocations[asset] - reduction);
                        document.getElementById(asset + 'Value').textContent = currentAllocations[asset];
                        document.getElementById(asset + 'Slider').value = currentAllocations[asset];
                    });
                }
                
                // Update chart
                updateChart();
                
                // Recalculate products and SIP
                const products = getProductRecommendations(currentAllocations);
                const sipStrategy = calculateSIPStrategy(currentAllocations);
                displayProductBreakdown(products, currentAllocations);
                displaySIPStrategy(sipStrategy, products);
                
            } catch (error) {
                console.error('Error in updateAllocation:', error);
            }
        }

        function updateSubAllocation(subAssetType, value) {
            try {
                value = parseInt(value);
                document.getElementById(subAssetType + 'Value').textContent = value;
                
                // Here you could implement more detailed sub-asset allocation logic
                // For now, just update the display
                
            } catch (error) {
                console.error('Error in updateSubAllocation:', error);
            }
        }

        function resetToRecommended() {
            try {
                // Recalculate original recommendations
                const riskProfile = calculateRiskProfile();
                const originalAllocations = calculateAllocations(riskProfile);
                currentAllocations = { ...originalAllocations };
                
                // Update all sliders and values
                Object.keys(currentAllocations).forEach(asset => {
                    const value = currentAllocations[asset];
                    document.getElementById(asset + 'Value').textContent = value;
                    document.getElementById(asset + 'Slider').value = value;
                });
                
                // Update chart and recommendations
                updateChart();
                const products = getProductRecommendations(currentAllocations);
                const sipStrategy = calculateSIPStrategy(currentAllocations);
                displayProductBreakdown(products, currentAllocations);
                displaySIPStrategy(sipStrategy, products);
                
            } catch (error) {
                console.error('Error in resetToRecommended:', error);
            }
        }

        function updateChart() {
            try {
                if (allocationChart) {
                    allocationChart.data.datasets[0].data = [
                        currentAllocations.equity,
                        currentAllocations.fixedIncome,
                        currentAllocations.alternatives,
                        currentAllocations.cash
                    ];
                    allocationChart.update();
                }
            } catch (error) {
                console.error('Error in updateChart:', error);
            }
        }

        // Display product breakdown
        function displayProductBreakdown(products, allocations) {
            try {
                const container = document.getElementById('productBreakdown');
                if (!container) return;

                let html = '<h3 style="margin-bottom: 20px; color: #333;">📊 Detailed Product Allocation</h3>';

                // Equity section
                if (products.equity.length > 0) {
                    html += `
                        <div class="asset-class-section">
                            <div class="asset-class-header">
                                <div class="asset-class-title">🚀 Equity Investments</div>
                                <div class="asset-class-allocation">${allocations.equity}%</div>
                            </div>
                            <div class="product-grid">
                    `;
                    
                    products.equity.forEach(product => {
                        html += `
                            <div class="product-card">
                                <div class="product-header">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-allocation">${product.allocation}%</div>
                                </div>
                                <div class="product-details">${product.details}</div>
                                <div class="product-type">${product.type}</div>
                                <div style="margin-top: 8px; font-size: 11px; color: #4CAF50; font-weight: bold;">
                                    Suggested: ${product.funds}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                // Fixed Income section
                if (products.fixedIncome.length > 0) {
                    html += `
                        <div class="asset-class-section">
                            <div class="asset-class-header">
                                <div class="asset-class-title">🏦 Fixed Income Investments</div>
                                <div class="asset-class-allocation">${allocations.fixedIncome}%</div>
                            </div>
                            <div class="product-grid">
                    `;
                    
                    products.fixedIncome.forEach(product => {
                        html += `
                            <div class="product-card">
                                <div class="product-header">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-allocation">${product.allocation}%</div>
                                </div>
                                <div class="product-details">${product.details}</div>
                                <div class="product-type">${product.type}</div>
                                <div style="margin-top: 8px; font-size: 11px; color: #4CAF50; font-weight: bold;">
                                    Suggested: ${product.funds}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                // Alternatives section
                if (products.alternatives.length > 0) {
                    html += `
                        <div class="asset-class-section">
                            <div class="asset-class-header">
                                <div class="asset-class-title">💎 Alternative Investments</div>
                                <div class="asset-class-allocation">${allocations.alternatives}%</div>
                            </div>
                            <div class="product-grid">
                    `;
                    
                    products.alternatives.forEach(product => {
                        html += `
                            <div class="product-card">
                                <div class="product-header">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-allocation">${product.allocation}%</div>
                                </div>
                                <div class="product-details">${product.details}</div>
                                <div class="product-type">${product.type}</div>
                            </div>
                        `;
                    });
                    
                    html += '</div></div>';
                }

                container.innerHTML = html;
            } catch (error) {
                console.error('Error in displayProductBreakdown:', error);
            }
        }

        // Display SIP strategy
        function displaySIPStrategy(sipStrategy, products) {
            try {
                const container = document.getElementById('sipStrategy');
                if (!container) return;

                let html = `
                    <div class="sip-header">💰 Monthly SIP Strategy</div>
                    <div class="sip-amount">₹${sipStrategy.total.toLocaleString()}/month</div>
                    <p style="color: #2d5f2d; margin-bottom: 20px;">Recommended monthly investment based on your surplus income</p>
                `;

                if (sipStrategy.total > 0) {
                    html += `
                        <div class="monthly-breakdown">
                            <div class="monthly-item">
                                <div class="monthly-amount">₹${sipStrategy.equity.toLocaleString()}</div>
                                <div class="monthly-product">Equity SIPs</div>
                            </div>
                            <div class="monthly-item">
                                <div class="monthly-amount">₹${sipStrategy.fixedIncome.toLocaleString()}</div>
                                <div class="monthly-product">Fixed Income</div>
                            </div>
                            <div class="monthly-item">
                                <div class="monthly-amount">₹${sipStrategy.alternatives.toLocaleString()}</div>
                                <div class="monthly-product">Alternatives</div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <p style="color: #d32f2f; background: #ffebee; padding: 15px; border-radius: 8px;">
                            ⚠️ Your expenses are very close to your income. Focus on increasing income or reducing expenses before investing.
                        </p>
                    `;
                }

                container.innerHTML = html;
            } catch (error) {
                console.error('Error in displaySIPStrategy:', error);
            }
        }

        // Chart creation
        function createChart(allocations) {
            try {
                const ctx = document.getElementById('allocationChart');
                if (!ctx) return;

                // Destroy existing chart
                if (allocationChart) {
                    allocationChart.destroy();
                }

                allocationChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Equity', 'Fixed Income', 'Alternatives', 'Cash'],
                        datasets: [{
                            data: [allocations.equity, allocations.fixedIncome, allocations.alternatives, allocations.cash],
                            backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#e0e0e0'],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error in createChart:', error);
            }
        }

        // Premium features
        function showPremiumFeatures() {
            alert('Premium features coming soon! This will integrate with RevenueCat for subscription management.');
        }

        // Restart and dashboard functions
        function restartAssessment() {
            try {
                currentQuestion = 1;
                assessmentData = {};
                
                document.getElementById('results').style.display = 'none';
                document.getElementById('questionnaire').style.display = 'block';
                
                // Reset all questions
                for (let i = 1; i <= totalQuestions; i++) {
                    const section = document.getElementById(`question${i}`);
                    if (section) {
                        if (i === 1) {
                            section.classList.remove('hidden');
                        } else {
                            section.classList.add('hidden');
                        }
                    }
                }
                
                // Clear selections and inputs
                document.querySelectorAll('.option.selected').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                document.querySelectorAll('.input-field').forEach(input => {
                    input.value = '';
                });
                
                updateProgress();
                updateNavigationButtons();
            } catch (error) {
                console.error('Error in restartAssessment:', error);
            }
        }

        function proceedToDashboard() {
            alert('Proceeding to portfolio tracking dashboard with your personalized investment plan!');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            try {
                updateProgress();
                updateNavigationButtons();
            } catch (error) {
                console.error('Error in initialization:', error);
            }
        });
    </script>
</body>
</html>
